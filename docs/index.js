(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function r(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(s){if(s.ep)return;s.ep=!0;const a=r(s);fetch(s.href,a)}})();const Le=""+new URL("service-worker.js",import.meta.url).href;window.navigator.serviceWorker.register(Le).catch(console.error);let T;V(),document.addEventListener("visibilitychange",()=>{document.hidden?Se():V()});async function V(){var e,t;T=await((t=(e=navigator.wakeLock)==null?void 0:e.request)==null?void 0:t.call(e,"screen"))}async function Se(){T&&(await T.release(),T=void 0)}const b={width:30,height:24};function J(e){return e%2===0}function $e(e,t,r){return e>=t&&e<=r}function qe(e,t=0,r=e.length){return e[j(r,t)]}function j(e,t=0){return Math.trunc(Math.random()*(e-t)+t)}function ee(e){return Object.freeze(Object.assign(Object.create(null),e))}function te(e){e.preventDefault()}function re(e){e.forEach(t=>{t.neighbors=ke(t,e,b)})}function ke({q:e,r:t,s:r,x:o,y:s},a,i){const _=[{q:1,r:0,s:-1},{q:1,r:-1,s:0},{q:0,r:1,s:-1},{q:0,r:-1,s:1},{q:-1,r:0,s:1},{q:-1,r:1,s:0}].map(c=>a.find(h=>h.q===e+c.q&&h.r===t+c.r&&h.s===r+c.s)).filter(Boolean);return o===0&&(_.push(a.find(c=>s===c.y&&c.x===i.width-1)),J(s)&&_.push(...[s<i.height-1?a.find(c=>s+1===c.y&&c.x===i.width-1):null,s>0?a.find(c=>s-1===c.y&&c.x===i.width-1):null].filter(Boolean))),o===i.width-1&&(_.push(a.find(c=>s===c.y&&c.x===0)),J(s)||_.push(...[s<i.height-1?a.find(c=>s+1===c.y&&c.x===0):null,s>0?a.find(c=>s-1===c.y&&c.x===0):null].filter(Boolean))),_}const g={freezing:"freezing",cold:"cold",temperate:"temperate",warm:"warm",hot:"hot"};function ne(e){e.forEach(t=>{const r=Math.random(),o=-1,s=$e(r,.3,.7)?0:1*(-1*+(r<.3)),a=(i=>i<0?0:i>b.height-1?b.height-1:i)(t.y+s+o);t.temperature=Oe(a)})}function Oe(e){switch(e){case 0:case 1:case b.height-2:case b.height-1:return g.freezing;case 2:case 3:case b.height-4:case b.height-3:return g.cold;case 4:case 5:case b.height-6:case b.height-5:return g.temperate;case 6:case 7:case 8:case b.height-9:case b.height-8:case b.height-7:return g.warm;default:return g.hot}}function Ie(e){switch(e){case g.hot:return g.warm;case g.warm:return g.temperate;case g.temperate:return g.cold;default:return g.freezing}}function Be(e){switch(e){case g.freezing:return g.cold;case g.cold:return g.temperate;case g.temperate:return g.warm;default:return g.hot}}const G=new Set([0,1,2,b.height-1,b.height-2,b.height-3]);function oe(e){const o=e.length/2.5;let s=0;for(;s<o;){const a=j(13,4),i={x:j(b.width),y:j(b.height-3,3)},l=e.find(({x:h,y:v})=>h===i.x&&v===i.y),_=new Set(l.neighbors.filter(({y:h})=>!G.has(h))),c=new Set;s+=a,X(l),c.add(l);for(let h=0;h<a;h+=1){const v=qe([..._]);X(v),c.add(v),_.delete(v),v.neighbors.filter(m=>!c.has(m)).filter(({y:m})=>!G.has(m)).forEach(m=>_.add(m))}}e.filter(a=>a.elevation>0).forEach(a=>{const i=a.neighbors.filter(_=>_.elevation>0).length;if(i>=3)return;const l=Math.random();(i===2&&l>.7||i===1&&l<.7)&&Ce(a)})}function X(e){e.elevation+=1,e.elevation>1&&(e.temperature=Ie(e.temperature))}function Ce(e){e.elevation=Math.max(0,e.elevation-1),e.elevation>0&&(e.temperature=Be(e.temperature))}const u={arid:"arid",dry:"dry",moderate:"moderate",moist:"moist",wet:"wet"};function Me(e){switch(e){case u.arid:return u.dry;case u.dry:return u.moderate;case u.moderate:return u.moist;default:return u.wet}}function ae(e){e.filter(t=>t.elevation>0).forEach(t=>{t.neighbors.filter(({biome:r})=>r===d.sea).forEach(()=>{t.humidity=Me(t.humidity)})})}const n=ee({people:"people",gold:"gold",cloth:"cloth",wood:"wood",stone:"stone",iron:"iron",food:"food",alcohol:"alcohol"}),ze=ee({[n.people]:5,[n.gold]:5,[n.cloth]:25,[n.wood]:25,[n.stone]:25,[n.iron]:0,[n.food]:50,[n.alcohol]:5}),d={sea:new w("sea",{[n.food]:1}),mountain:new w("mountain",{[n.wood]:2,[n.stone]:5,[n.food]:3}),high_mountain:new w("high_mountain",{[n.stone]:5}),ice:new w("ice",{[n.food]:2}),tundra:new w("tundra",{[n.cloth]:1,[n.wood]:2,[n.stone]:1,[n.food]:5}),grassland:new w("grassland",{[n.cloth]:3,[n.wood]:2,[n.stone]:2,[n.food]:5}),savanna:new w("savanna",{[n.cloth]:5,[n.wood]:5,[n.stone]:3,[n.food]:6}),boreal_forest:new w("boreal_forest",{[n.cloth]:4,[n.wood]:10,[n.stone]:3,[n.food]:5}),forest:new w("forest",{[n.cloth]:2,[n.wood]:10,[n.stone]:2,[n.food]:5}),tropical_rainforest:new w("tropical_rainforest",{[n.cloth]:3,[n.wood]:7,[n.stone]:1,[n.food]:5}),cold_swamp:new w("cold_swamp",{[n.cloth]:1,[n.wood]:2,[n.stone]:1,[n.food]:2}),swamp:new w("swamp",{[n.cloth]:1,[n.wood]:1,[n.stone]:0,[n.food]:3}),tropical_swamp:new w("tropical_swamp",{[n.cloth]:1,[n.wood]:3,[n.stone]:1,[n.food]:3}),desert:new w("desert",{[n.cloth]:1,[n.wood]:0,[n.stone]:2,[n.food]:1}),extreme_desert:new w("extreme_desert",{[n.cloth]:0,[n.wood]:0,[n.stone]:1,[n.food]:0})},Ne={[g.freezing]:{[u.arid]:d.tundra,[u.dry]:d.tundra,[u.moderate]:d.tundra,[u.moist]:d.boreal_forest,[u.wet]:d.boreal_forest},[g.cold]:{[u.arid]:d.tundra,[u.dry]:d.tundra,[u.moderate]:d.boreal_forest,[u.moist]:d.boreal_forest,[u.wet]:d.boreal_forest},[g.temperate]:{[u.arid]:d.tundra,[u.dry]:d.forest,[u.moderate]:d.forest,[u.moist]:d.forest,[u.wet]:d.swamp},[g.warm]:{[u.arid]:d.desert,[u.dry]:d.grassland,[u.moderate]:d.savanna,[u.moist]:d.forest,[u.wet]:d.tropical_swamp},[g.hot]:{[u.arid]:d.extreme_desert,[u.dry]:d.desert,[u.moderate]:d.grassland,[u.moist]:d.savanna,[u.wet]:d.tropical_rainforest}};function w(e="",t={},r=1,o=1){return{name:e,resource_production:Object.assign({[n.gold]:0,[n.cloth]:0,[n.wood]:0,[n.stone]:0,[n.iron]:0,[n.food]:0,[n.alcohol]:0},t),movement_speed:r,pleasantness:o}}function se(e){e.forEach(t=>{t.biome=Ae(t)})}function ie(e){e.filter(({elevation:t})=>t===0).forEach(t=>{t.biome=Pe(t)})}function Pe(e,t=b.height){const r=Math.random();return[0,t-1].includes(e.y)?r<=.1?d.sea:d.ice:[1,t-2].includes(e.y)?r<=.75?d.sea:d.ice:[2,t-3].includes(e.y)?r<=.9?d.sea:d.ice:d.sea}function Ae(e){return e.biome?e.biome:e.elevation>1?e.elevation>2?d.high_mountain:d.mountain:Ne[e.temperature][e.humidity]}const Re=document.getElementById("add-player-btn"),D=document.getElementById("board"),W=document.getElementById("bottom-bar"),N=document.getElementById("cell-info"),Te=document.getElementById("cell-debug-info"),C=document.getElementById("cell-production-forecast"),je=document.getElementById("toggle-coord-system-btn"),Z=document.getElementById("config-game-form"),ce=document.getElementById("defs"),le=document.getElementById("end-turn-btn"),F=document.getElementById("general-info"),U=document.getElementById("overall-production-forecast"),Ue=document.getElementById("phase-label"),P=document.getElementsByClassName("player-config"),De=document.getElementById("player-name"),de=document.getElementById("player-setup"),Fe=document.getElementById("reroll-map-btn"),He=document.getElementById("side-bar");document.getElementById("round-info");const Y=document.getElementById("selection-highlight"),Je=document.getElementById("start-game-form"),O=document.getElementById("start-game-overlay"),We=ce.querySelector(".cell-wrapper"),Ye=ce.querySelector(".player-border"),Ke=document.getElementById("player-config-tmpl").content,Qe=document.getElementById("structure-builder-tmpl").content,K={tent:I("Tent",[y(n.wood,1),y(n.cloth,3)],[],0,{on(e){e.housing_capacity+=5},off(e){e.housing_capacity-=5}},[]),textile_factory:I("Textile Factory",[y(n.wood,15),y(n.stone,15)],[y(n.cloth,5)]),lumber_mill:I("Lumber Mill",[y(n.wood,15),y(n.stone,15)],[y(n.wood,5)]),quarry:I("Quarry",[y(n.wood,15),y(n.stone,15)],[y(n.stone,5)]),forge:I("Forge",[y(n.wood,5),y(n.stone,5)],[y(n.iron,1)]),farm:I("Farm",[y(n.wood,5),y(n.stone,5)],[y(n.food,5)]),distillery:I("Distillery",[y(n.wood,5),y(n.stone,5)],[y(n.alcohol,1)])};function I(e="Pretty Structure",t=[y(n.wood,5)],r=[y(n.wood,1)],o=1,s={on(i){i.foo+=5},off(i){i.foo-=5}},a=[d.swamp]){return{display_name:e,construction_cost:t,unsupported_biomes:a,effects:s,output:r,required_workers:o}}function y(e=n.wood,t=1){return{resource_name:e,amount:t}}function ue(e,t,r,o,s,a,i){const l=Ve(e,t,r,o,s,a,i),_=l.querySelector(".population-size");let c=null,h=-1,v=0;return{cx:e,cy:t,x:r,y:o,q:s,r:a,s:i,neighbors:[],cell:l,elevation:0,humidity:u.arid,temperature:g.freezing,structures:new Map(Object.values(K).map(m=>[m,0])),resources:{get[n.people](){return v},set[n.people](m){v=m,_.textContent=v>0?v:""},[n.gold]:0,[n.cloth]:0,[n.wood]:0,[n.stone]:0,[n.iron]:0,[n.food]:0,[n.alcohol]:0},get biome(){return c},set biome(m){c!==null&&l.classList.remove(c.name),m!==null&&l.classList.add(m.name),c=m},get owner_id(){return h},set owner_id(m){h=m,m!==-1&&(l.dataset.owner_id=m)}}}function Ve(e,t,r,o,s,a,i){const l=We.cloneNode(!0);return l.setAttribute("transform",`translate(${e}, ${t})`),l.querySelector(".q-coord").textContent=s,l.querySelector(".r-coord").textContent=a,l.querySelector(".s-coord").textContent=i,l.querySelector(".offset-coords").textContent=`${r}, ${o}`,D.prepend(l),l}function me(e){const t=[...e.values()];return t.forEach(r=>Object.assign(r,{biome:null,elevation:0,humidity:u.arid,temperature:g.freezing,resources:Object.keys(r.resources).reduce((o,s)=>(o[s]=0,o),r.resources),owner_id:-1})),ne(t),oe(t),ie(t),ae(t),se(t),e}function Ge(e,t){const r=e.map(({cx:o,cy:s,x:a,y:i,q:l,r:_,s:c,biome_name:h,elevation:v,humidity:m,temperature:k,owner_id:f,resources:M})=>{const B=ue(o,s,a,i,l,_,c);return Object.assign(B,{biome:d[h],elevation:v,humidity:m,temperature:k,owner_id:f}),Object.entries(M).forEach(([we,Ee])=>{B.resources[we]=Ee}),B});return re(r),fe(r,t)}function Xe(e,t){const r=Ze(e);return re(r),ne(r),oe(r),ie(r),ae(r),se(r),fe(r,t)}function fe(e,t){return e.reduce((r,o)=>(r.set(o.cell,o),r),t)}function Ze({height:e,width:t}){const r=[];for(let o=0;o<e;o+=1){const s=+!J(o);for(let a=0;a<t;a+=1){const i=a-(o-(o&1))/2;r.push(ue(a*6+s*3,o*4.5,a,o,i,o,-i-o))}}return r}const pe=.5,$=pe*.5;function _e(e,t,r){const o=[];e.reduce((a,i)=>{const l=i.neighbors.filter(f=>!e.includes(f)),_=xe(i),c=et(i),h=ot(i),v=rt(i),m=nt(i),k=tt(i);return l.find(f=>f.r===i.r&&f.s===i.s+1)&&a.push(`M${v}L${k}`),l.find(f=>f.q===i.q&&f.s===i.s+1)&&a.push(`M${k}L${_}`),l.find(f=>f.s===i.s&&f.r===i.r-1)&&a.push(`M${_}L${m}`),l.find(f=>f.r===i.r&&f.s===i.s-1)&&a.push(`M${m}L${h}`),l.find(f=>f.q===i.q&&f.s===i.s-1)&&a.push(`M${h}L${c}`),l.find(f=>f.s===i.s&&f.r===i.r+1)&&a.push(`M${c}L${v}`),a},o);const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d",o.join("")),s.setAttribute("stroke",t),s.setAttribute("stroke-width",pe),r.append(s)}function xe(e){return`${e.cx+3} ${e.cy+$}`}function et(e){return`${e.cx+3} ${e.cy+6-$}`}function tt(e){return`${e.cx+$} ${e.cy+1.5+$*.5}`}function rt(e){return`${e.cx+$} ${e.cy+4.5-$*.5}`}function nt(e){return`${e.cx+6-$} ${e.cy+1.5+$*.5}`}function ot(e){return`${e.cx+6-$} ${e.cy+4.5-$*.5}`}const at={human:"human",ai:"ai"};function he(e){const t=Ke.cloneNode(!0);Object.assign(t.querySelector(".player-name-input"),{name:`player-${e}-name`,value:`Player ${e}`}),t.querySelectorAll(".player-type-select-radio").forEach(r=>{r.name=`player-${e}-type`}),de.append(t)}function ge(e,t="Player Name",r=at.ai){const o=[],s=Ye.cloneNode(!0);return D.append(s),{name:t,type:r,get resources(){return o.reduce((a,{resources:i})=>(Object.entries(i).forEach(([l,_])=>{a[l]+=_}),a),{[n.people]:0,[n.gold]:0,[n.cloth]:0,[n.wood]:0,[n.stone]:0,[n.iron]:0,[n.food]:0,[n.alcohol]:0})},border_path_container:s,get cells(){return o},set cells(a){o.push(...a),_e(o,`var(--player-${e+1})`,s)},destroy(){o.length=0,s.remove()}}}function A(e,t=1){const r={[n.people]:0,[n.gold]:0,[n.cloth]:0,[n.wood]:0,[n.stone]:0,[n.iron]:0,[n.food]:0,[n.alcohol]:0};let o=0;return e.forEach(s=>{o+=s.resources.people,Object.entries(s.biome.resource_production).forEach(([a,i])=>{r[a]+=i}),[...s.structures.entries()].forEach(([a,i])=>{a.output.forEach(({resource_name:l,amount:_})=>{r[l]+=_*i})});for(let a=0;a<Math.floor(s.resources.people/2);a+=1){const i=Math.random();i<.3?r[n.people]+=2:i<.8&&(r[n.people]+=1)}}),r[n.gold]=o*t,r}function ye(e,t){U.querySelector("ul").replaceChildren(...Q(e)),U.querySelector("input").value=t,U.classList.remove("hidden")}function st(e,t){C.querySelector("ul").replaceChildren(...Q(e)),C.querySelector("fieldset").replaceChildren(...t),C.classList.remove("hidden")}function it(e,{wood:t,stone:r,cloth:o,food:s}){const a=Object.values(K).filter(i=>!i.unsupported_biomes.includes(e.biome)).map(({display_name:i})=>`<li>${i}</li>`).join("");N.innerHTML=`
        <h2>Cell Info</h2>
        <div>Biome: ${e.biome.name}</div>
        <div>Movement modifier: ${e.biome.movement_speed}</div>
        <div>Pleasantness: ${e.biome.pleasantness}</div>
        ...
        <h3>Production</h3>
        <div>Wood: ${t}</div>
        <div>Stone: ${r}</div>
        <div>Cloth: ${o}</div>
        <div>Food: ${s}</div>
        <h3>Supported structures</h3>
        <ul>${a}</ul>
    `,N.classList.remove("hidden")}function Q(e){return Object.entries(e).map(([t,r])=>Object.assign(document.createElement("li"),{textContent:`${t}: ${r}`}))}function ct(e){return Object.entries(K).filter(([,t])=>!t.unsupported_biomes.includes(e.biome)).map(([t,r])=>{const o=Qe.cloneNode(!0).lastElementChild,s=o.querySelector(".label-text"),a=o.querySelector(".structure-count");return o.dataset.structure_name=t,s.textContent=`${r.display_name}: `,a.textContent=e.structures.get(r),s.addEventListener("click",()=>{}),o.addEventListener("click",({target:i})=>{const l=i.closest("button");if(l===null)return;const _=l.classList.contains("construct-structure-btn"),c=r.construction_cost;let h=e.structures.get(r);if(_){if(c.some(({resource_name:m,amount:k})=>k>p.active_player.resources[m]))return;h+=1,c.forEach(({resource_name:m,amount:k})=>{let f=k;for(const M of p.active_player.cells){const B=M.resources[m];if(B<f){f-=B,M.resources[m]=0;continue}else M.resources[m]-=f,f=0;if(f===0)break}})}else{if(h===0)return;h-=1,c.forEach(({resource_name:v,amount:m})=>{e.resources[v]+=m})}e.structures.set(r,h),a.textContent=h,C.querySelector("ul").replaceChildren(...Q(A([e],p.active_player.tax_rate))),p.update_resource_display()}),o})}let z=null;const L={land_grab:R("land_grab","Pick your origin","Confirm choice",(e,t)=>{e.owner_id===-1&&e.biome!==d.sea?(z=t,_e([...e.neighbors,e],"white",Y),F.classList.add("hidden"),it(e,e.biome.resource_production)):(N.classList.add("hidden"),F.classList.remove("hidden"))}),development:R("development","Distribute your wealth",void 0,(e,t,r)=>{e.owner_id!==r.current_player_id?(C.classList.add("hidden"),ye(A(r.active_player.cells,r.active_player.tax_rate),r.active_player.tax_rate)):(z=e,U.classList.add("hidden"),st(A([e],r.active_player.tax_rate),ct(e)))}),movement_planning:R("movement_planning","Make your moves"),movement_execution:R("movement_execution","See what you have done")};function lt(e){return({target:t})=>{const r=Number(t.value);t.name==="tax_rate"&&(e.active_player.tax_rate=r)}}function dt(e){return()=>{if(e.current_phase===L.land_grab.name){if(z===null)return;const t=e.board.get(z);Object.entries(ze).forEach(([r,o])=>{t.resources[r]=o}),t.owner_id=e.current_player_id,e.active_player.cells=[t],z=null}e.next_turn()}}function R(e="round_phase",t=e,r="End turn",o=()=>{}){return{name:e,call_to_action:t,end_turn_btn_label:r,handler_function:o}}const S=[];let H=0,q=L.land_grab.name,E=0,ve=null;const p={board:new Map,get round(){return H},set round(e){H=e},get active_player(){return S[E]},get players(){return S},set players(e){S.push(...e)},get current_player_id(){return E},set current_player_id(e){E=e},get current_player_total_production(){return ve},clear_players(){S.forEach(e=>e.destroy()),S.length=0},get current_phase(){return q},set current_phase(e){q=e},update_resource_display:be,next_turn(){Y.replaceChildren(),E===S.length-1?(E=0,q=(()=>{switch(q){case L.development.name:return L.movement_planning.name;case L.movement_planning.name:return L.movement_execution.name;default:return H+=1,L.development.name}})()):E+=1,x()},run:x};function x(){le.textContent=L[q].end_turn_btn_label,Ue.textContent=L[q].call_to_action,De.textContent=S[E].name,document.body.dataset.current_phase=L[q].name,document.documentElement.style.setProperty("--active-player-color",`var(--player-${E+1}`),q===L.land_grab.name&&(N.classList.add("hidden"),F.classList.remove("hidden")),q===L.development.name?(N.classList.add("hidden"),F.classList.add("hidden"),ve=A(S[E].cells,S[E].tax_rate),C.classList.add("hidden"),ye(A(S[E].cells,S[E].tax_rate),S[E].tax_rate),W.classList.remove("content-hidden"),be()):W.classList.add("content-hidden")}function be(){W.replaceChildren(...Object.entries(S[E].resources).map(([e,t])=>Object.assign(document.createElement("div"),{textContent:`${e}: ${t}`})))}function ut(e,t){const r=JSON.parse(t);Object.assign(e,{round:r.round,current_phase:r.current_phase,current_player_id:r.current_player_id,players:r.players.map(({name:o,type:s},a)=>ge(a,o,s)),board:Ge(r.board,e.board)}),e.players.forEach((o,s)=>{o.cells=[...e.board.values()].filter(a=>a.owner_id===s)})}function mt(){if(p.players.length===0){localStorage.removeItem("wargame-savegame");return}localStorage.setItem("wargame-savegame",JSON.stringify({round:p.round,current_phase:p.current_phase,current_player_id:p.current_player_id,players:p.players.map(({name:e,type:t})=>({name:e,type:t})),board:[...p.board.values()].map(({cx:e,cy:t,x:r,y:o,q:s,r:a,s:i,biome:{name:l},elevation:_,humidity:c,temperature:h,owner_id:v,resources:m})=>({cx:e,cy:t,x:r,y:o,q:s,r:a,s:i,biome_name:l,elevation:_,humidity:c,temperature:h,owner_id:v,resources:m}))}))}window.addEventListener("DOMContentLoaded",()=>{const e=localStorage.getItem("wargame-savegame"),t=e!==null;O.dataset.priorSave=t,O.showModal(),t?ut(p,e):p.board=Xe(b,p.board)},{once:!0});document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&mt()});O.addEventListener("cancel",te);document.addEventListener("submit",te);Je.addEventListener("submit",e=>{if(e.submitter.id==="new-game-btn")O.dataset.priorSave==="true"&&(Object.assign(p,{round:0,current_phase:L.land_grab.name,current_player_id:0}),p.board=me(p.board),p.clear_players()),Array.from({length:2},(t,r)=>he(r+1)),O.classList.add("game-config");else{if(O.dataset.priorSave==="false")return;p.run(),O.close()}});Fe.addEventListener("click",()=>{p.board=me(p.board)});le.addEventListener("click",dt(p));Z.addEventListener("submit",()=>{const e=new Set,t=[...Z.querySelectorAll(".player-name-input")];if(t.reduce((r,{value:o})=>(r[o]=o in r?r[o]+1:1,r[o]>1&&e.add(o),r),{}),e.size>0){t.forEach(r=>{e.has(r.value)&&r.classList.add("invalid")});return}p.players=Array.from(P,(r,o)=>{const s=r.querySelector(".player-name-input").value,a=r.querySelector(".player-type-select-radio:checked").value;return ge(o,s,a)}),p.run(),O.close()});Re.addEventListener("click",()=>{P.length!==5&&he(P.length+1)});de.addEventListener("click",({target:e})=>{e.closest(".delete-player-btn")&&P.length!==2&&(e.closest(".player-config").remove(),[...P].forEach((t,r)=>{r=r+1,Object.assign(t.querySelector(".player-name-input"),{name:`player-${r}-name`,value:`Player ${r}`}),t.querySelectorAll(".player-type-select-radio").forEach(o=>{o.name=`player-${r}-type`})}))});D.addEventListener("click",({target:e})=>{const t=e.closest(".cell-wrapper");if(!t)return;const r=D.querySelector(".clicked"),o=p.board.get(t);r&&(r.classList.remove("clicked"),Y.replaceChildren(),r===t)||(t.classList.add("clicked"),ft(o),L[p.current_phase].handler_function(o,t,p))});He.addEventListener("input",lt(p));document.querySelector("h1").addEventListener("dblclick",()=>{document.body.classList.toggle("debug")});je.addEventListener("click",()=>{document.body.classList.toggle("use-offset-coords")});function ft(e){Te.textContent=JSON.stringify(e,(t,r)=>t==="neighbors"?void 0:r,4)}
