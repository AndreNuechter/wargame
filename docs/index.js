(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();const C=""+new URL("service-worker.js",import.meta.url).href;window.navigator.serviceWorker.register(C).catch(console.error);const p={width:30,height:24};function S(e){return e%2===0}function D(e,t,n){return e>=t&&e<=n}function R(e,t=0,n=e.length){return e[L(n,t)]}function L(e,t=0){return Math.trunc(Math.random()*(e-t)+t)}function x(e){e.forEach(t=>{t.neighbors=T(t,e,p)})}function T({q:e,r:t,s:n,x:o,y:r},a,l){const m=[{q:1,r:0,s:-1},{q:1,r:-1,s:0},{q:0,r:1,s:-1},{q:0,r:-1,s:1},{q:-1,r:0,s:1},{q:-1,r:1,s:0}].map(s=>a.find(f=>f.q===e+s.q&&f.r===t+s.r&&f.s===n+s.s)).filter(Boolean);return o===0&&(m.push(a.find(s=>r===s.y&&s.x===l.width-1)),S(r)&&m.push(...[r<l.height-1?a.find(s=>r+1===s.y&&s.x===l.width-1):null,r>0?a.find(s=>r-1===s.y&&s.x===l.width-1):null].filter(Boolean))),o===l.width-1&&(m.push(a.find(s=>r===s.y&&s.x===0)),S(r)||m.push(...[r<l.height-1?a.find(s=>r+1===s.y&&s.x===0):null,r>0?a.find(s=>r-1===s.y&&s.x===0):null].filter(Boolean))),m}const d={freezing:"freezing",cold:"cold",temperate:"temperate",warm:"warm",hot:"hot"};function N(e){e.forEach(t=>{const n=Math.random(),o=-1,r=D(n,.3,.7)?0:1*(-1*+(n<.3)),a=(l=>l<0?0:l>p.height-1?p.height-1:l)(t.y+r+o);t.temperature=U(a)})}function U(e){switch(e){case 0:case 1:case p.height-2:case p.height-1:return d.freezing;case 2:case 3:case p.height-4:case p.height-3:return d.cold;case 4:case 5:case p.height-6:case p.height-5:return d.temperate;case 6:case 7:case 8:case p.height-9:case p.height-8:case p.height-7:return d.warm;default:return d.hot}}function H(e){switch(e){case d.hot:return d.warm;case d.warm:return d.temperate;case d.temperate:return d.cold;default:return d.freezing}}function W(e){switch(e){case d.freezing:return d.cold;case d.cold:return d.temperate;case d.temperate:return d.warm;default:return d.hot}}const $=new Set([0,1,2,p.height-1,p.height-2,p.height-3]);function q(e){const o=e.length/2.5;let r=0;for(;r<o;){const a=L(13,4),l={x:L(p.width),y:L(p.height-3,3)},u=e.find(({x:f,y:_})=>f===l.x&&_===l.y),m=new Set(u.neighbors.filter(({y:f})=>!$.has(f))),s=new Set;r+=a,k(u),s.add(u);for(let f=0;f<a;f+=1){const _=R([...m]);k(_),s.add(_),m.delete(_),_.neighbors.filter(h=>!s.has(h)).filter(({y:h})=>!$.has(h)).forEach(h=>m.add(h))}}e.filter(a=>a.elevation>0).forEach(a=>{const l=a.neighbors.filter(m=>m.elevation>0).length;if(l>=3)return;const u=Math.random();(l===2&&u>.7||l===1&&u<.7)&&Y(a)})}function k(e){e.elevation+=1,e.elevation>1&&(e.temperature=H(e.temperature))}function Y(e){e.elevation=Math.max(0,e.elevation-1),e.elevation>0&&(e.temperature=W(e.temperature))}const c={arid:"arid",dry:"dry",moderate:"moderate",moist:"moist",wet:"wet"};function J(e){switch(e){case c.arid:return c.dry;case c.dry:return c.moderate;case c.moderate:return c.moist;default:return c.wet}}function B(e){e.filter(t=>t.elevation>0).forEach(t=>{t.neighbors.filter(({biome:n})=>n===i.sea.name).forEach(()=>{t.humidity=J(t.humidity)})})}const i={sea:new g("sea"),mountain:new g("mountain"),high_mountain:new g("high_mountain"),ice:new g("ice"),tundra:new g("tundra"),grassland:new g("grassland"),savanna:new g("savanna"),boreal_forest:new g("boreal_forest"),forest:new g("forest"),tropical_rainforest:new g("tropical_rainforest"),cold_swamp:new g("cold_swamp"),swamp:new g("swamp"),tropical_swamp:new g("tropical_swamp"),desert:new g("desert"),extreme_desert:new g("extreme_desert")},F={[d.freezing]:{[c.arid]:i.tundra.name,[c.dry]:i.tundra.name,[c.moderate]:i.tundra.name,[c.moist]:i.boreal_forest.name,[c.wet]:i.boreal_forest.name},[d.cold]:{[c.arid]:i.tundra.name,[c.dry]:i.tundra.name,[c.moderate]:i.boreal_forest.name,[c.moist]:i.boreal_forest.name,[c.wet]:i.boreal_forest.name},[d.temperate]:{[c.arid]:i.tundra.name,[c.dry]:i.forest.name,[c.moderate]:i.forest.name,[c.moist]:i.forest.name,[c.wet]:i.swamp.name},[d.warm]:{[c.arid]:i.desert.name,[c.dry]:i.grassland.name,[c.moderate]:i.savanna.name,[c.moist]:i.forest.name,[c.wet]:i.tropical_swamp.name},[d.hot]:{[c.arid]:i.extreme_desert.name,[c.dry]:i.desert.name,[c.moderate]:i.grassland.name,[c.moist]:i.savanna.name,[c.wet]:i.tropical_rainforest.name}};function g(e){return{name:e}}function I(e){e.forEach(t=>{t.biome=K(t)})}function A(e){e.filter(({elevation:t})=>t===0).forEach(t=>{t.biome=G(t)})}function G(e,t=p.height){const n=Math.random();return[0,t-1].includes(e.y)?n<=.1?i.sea.name:i.ice.name:[1,t-2].includes(e.y)?n<=.75?i.sea.name:i.ice.name:[2,t-3].includes(e.y)?n<=.9?i.sea.name:i.ice.name:i.sea.name}function K(e){return e.biome?e.biome:e.elevation>1?e.elevation>2?i.high_mountain.name:i.mountain.name:F[e.temperature][e.humidity]}const M=document.createElement("style");M.textContent=Object.values(i).map(e=>`[data-biome="${e.name}"] {
        .outer-cell:not(.owned),
        .inner-cell {
            fill: var(--${e.name});
        }
    }`).join(`
`);document.body.append(M);const v=document.getElementById("board"),V=document.getElementById("cell-info"),Q=document.getElementById("toogle-coord-system-btn"),y=document.getElementById("start-game-overlay"),X=document.getElementById("start-game-form"),Z=document.getElementById("config-game-form"),ee=document.getElementById("reroll-map-btn"),O=document.getElementById("player-setup"),te=document.getElementById("add-player-btn"),ne=document.getElementById("round-info"),E=document.getElementsByClassName("player-config"),re=(()=>{const e=document.createElementNS("http://www.w3.org/2000/svg","use"),t=document.createElementNS("http://www.w3.org/2000/svg","use"),n=document.createElementNS("http://www.w3.org/2000/svg","g");return t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#inner-hex"),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#outer-hex"),t.classList.add("inner-cell"),e.classList.add("outer-cell"),n.classList.add("cell"),n.append(e,t),n})(),ae=document.getElementById("player-config-tmpl").content;function z(e,t,n,o,r,a,l){const u=oe(e,t,n,o,r,a,l);let m="";return{cx:e,cy:t,x:n,y:o,q:r,r:a,s:l,neighbors:[],cell:u,elevation:0,humidity:c.arid,temperature:d.freezing,get biome(){return m},set biome(s){m=s,u.dataset.biome=s}}}function oe(e,t,n,o,r,a,l){const u=re.cloneNode(!0);u.setAttribute("transform",`translate(${e}, ${t})`);const m=document.createElementNS("http://www.w3.org/2000/svg","g"),s=document.createElementNS("http://www.w3.org/2000/svg","text"),f=document.createElementNS("http://www.w3.org/2000/svg","text"),_=document.createElementNS("http://www.w3.org/2000/svg","text"),h=document.createElementNS("http://www.w3.org/2000/svg","text");return s.textContent=`${r}`,f.textContent=`${a}`,_.textContent=`${l}`,h.textContent=`${n}, ${o}`,s.setAttribute("transform",`translate(${1.5}, 2)`),f.setAttribute("transform",`translate(${4.5}, ${3.5})`),_.setAttribute("transform","translate(2, 5)"),h.setAttribute("transform",`translate(${1.5}, ${3.5})`),m.classList.add("cell-coord"),s.classList.add("cube-coord"),f.classList.add("cube-coord"),_.classList.add("cube-coord"),h.classList.add("offset-coord"),m.append(s,f,_,h),u.append(m),v.append(u),u}function P(e){const t=[...e.values()];return t.forEach(n=>Object.assign(n,{biome:"",elevation:0,humidity:c.arid,temperature:d.freezing})),N(t),q(t),A(t),B(t),I(t),e}function se(e){const t=JSON.parse(e).map(({cx:n,cy:o,x:r,y:a,q:l,r:u,s:m,biome:s,elevation:f,humidity:_,temperature:h})=>Object.assign(z(n,o,r,a,l,u,m),{biome:s,elevation:f,humidity:_,temperature:h}));return x(t),t.reduce((n,o)=>(n.set(o.cell,o),n),new Map)}function ie(e){const t=ce(e);return x(t),N(t),q(t),A(t),B(t),I(t),t.reduce((n,o)=>(n.set(o.cell,o),n),new Map)}function ce({height:e,width:t}){const n=[];for(let o=0;o<e;o+=1){const r=+!S(o);for(let a=0;a<t;a+=1){const l=a-(o-(o&1))/2;n.push(z(a*6+r*3,o*4.5,a,o,l,o,-l-o))}}return n}const le={human:"human",ai:"ai"};function j(e){const t=ae.cloneNode(!0);Object.assign(t.querySelector(".player-name-input"),{name:`player-${e}-name`,value:`Player ${e}`}),t.querySelectorAll(".player-type-select-radio").forEach(n=>{n.name=`player-${e}-type`}),O.append(t)}function de(e,t){let n=t||`Player ${e}`;return{get name(){return n},set name(o){o!==""&&(n=o)},color:"",type:le.ai,cells:[]}}const b={land_grab:"land_grab",development:"development",movement_planning:"movement_planning",movement_execution:"movement_execution"},w=(()=>{const e=[];let t=b.land_grab,n=0;return{board:new Map,round:0,players:e,get current_player_id(){return n},next_player(){return n=Math.min(n+1,e.length-1),n},get current_phase(){return t},increment_phase(){switch(t){case b.development:t=b.movement_planning;break;case b.movement_planning:t=b.movement_execution;break}},run(){console.log(13,t,e),ne.textContent=`${e[n].name} ${t}`}}})();window.addEventListener("DOMContentLoaded",()=>{const e=localStorage.getItem("wargame-board-state"),t=e!==null;y.dataset.priorSave=t,y.showModal(),w.board=t?se(e):ie(p)},{once:!0});window.addEventListener("beforeunload",()=>{localStorage.setItem("wargame-board-state",JSON.stringify([...w.board.values()].map(({cx:e,cy:t,x:n,y:o,q:r,r:a,s:l,biome:u,elevation:m,humidity:s,temperature:f})=>({cx:e,cy:t,x:n,y:o,q:r,r:a,s:l,biome:u,elevation:m,humidity:s,temperature:f}))))});X.addEventListener("submit",e=>{e.preventDefault(),e.submitter.id==="new-game-btn"?(y.dataset.priorSave==="true"&&(w.board=P(w.board)),Array.from({length:2},(t,n)=>j(n+1)),y.classList.add("game-config")):y.close()});ee.addEventListener("click",()=>{w.board=P(w.board)});Z.addEventListener("submit",e=>{e.preventDefault(),w.players.push(...Array.from(E,(t,n)=>{const o=t.querySelector(".player-name-input").value;return t.querySelector(".player-type-select-radio:checked").value,de(n+1,o)})),w.run(),y.close()});te.addEventListener("click",()=>{E.length!==5&&j(E.length+1)});O.addEventListener("click",({target:e})=>{e.closest(".delete-player-btn")&&E.length!==2&&(e.closest(".player-config").remove(),[...E].forEach((t,n)=>{n=n+1,Object.assign(t.querySelector(".player-name-input"),{name:`player-${n}-name`,value:`Player ${n}`}),t.querySelectorAll(".player-type-select-radio").forEach(o=>{o.name=`player-${n}-type`})}))});y.addEventListener("cancel",e=>e.preventDefault());Q.addEventListener("click",()=>{document.body.classList.toggle("use-offset-coords")});v.addEventListener("click",({target:e})=>{const t=e.closest(".cell");if(!t)return;const n=v.querySelector(".clicked"),o=w.board.get(t);n&&(n.classList.remove("clicked"),v.querySelectorAll(".adjacent-to-clicked").forEach(r=>r.classList.remove("adjacent-to-clicked")),n===t)||(t.classList.add("clicked"),o.neighbors.forEach(({cell:r})=>r.classList.add("adjacent-to-clicked")))});v.addEventListener("pointerover",({target:e})=>{const t=e.closest(".cell");if(!t)return;const n=w.board.get(t);V.textContent=`
        biome: ${n.biome},
        temperature: ${n.temperature},
        humidity: ${n.humidity},
        elevation: ${n.elevation}
    `});
